<?php
use san\San\Models\CareerPositions;
$positions = CareerPositions::orderBy('title')->get();
$currentFilter = input('position_filter', 'all');
?>
<div data-control="toolbar" style="display: flex; align-items: center; gap: 10px;">
    <button class="btn btn-default oc-icon-trash-o" disabled="disabled" onclick="$(this).data('request-data', {
            checked: $('.control-list').listWidget('getChecked')
        })" data-request="onDelete"
        data-request-confirm="<?= e(trans('backend::lang.list.delete_selected_confirm')) ?>"
        data-trigger-action="enable" data-trigger=".control-list input[type=checkbox]" data-trigger-condition="checked"
        data-request-success="$(this).prop('disabled', true)" data-stripe-load-indicator>
        <?= e(trans('backend::lang.list.delete_selected')) ?>
    </button>
    
    <form action="<?= Backend::url('san/san/careers/export') ?>" method="post" style="margin: 0;">
        <?= Form::token() ?>
        <input type="hidden" name="all_ids" id="all_ids">
        <button type="submit" class="btn btn-primary oc-icon-download">Export Data</button>
    </form>
    
    <div style="display: flex; align-items: center; gap: 5px;">
        <select id="position_filter" name="position_filter" class="form-control" style="width: 200px; display: inline-block;">
            <option value="all" <?= $currentFilter === 'all' ? 'selected' : '' ?>>All Positions</option>
            <?php foreach ($positions as $position): ?>
                <option value="<?= e($position->title) ?>" <?= $currentFilter === $position->title ? 'selected' : '' ?>>
                    <?= e($position->title) ?>
                </option>
            <?php endforeach; ?>
        </select>
    </div>

    <!-- <button class="btn btn-default oc-icon-download" disabled="disabled" onclick="$(this).data('request-data', {
            checked: $('.control-list').listWidget('getChecked')
        })" data-request="onDownlaod"
        data-request-confirm="download"
        data-trigger-action="enable" data-trigger=".control-list input[type=checkbox]" data-trigger-condition="checked"
        data-request-success="$(this).prop('disabled', true)" data-stripe-load-indicator>
        Downlaod
    </button> -->
</div>

<script>
    $(document).ready(function() {
        $('#position_filter').on('change', function() {
            var selectedPosition = $(this).val();
            var currentUrl = window.location.href.split('?')[0];
            var url = currentUrl;
            
            if (selectedPosition !== 'all') {
                url += '?position_filter=' + encodeURIComponent(selectedPosition);
            }
            
            window.location.href = url;
        });
    });
</script>