<?php
use san\San\Models\CareerPositions;
$data = post();
if($data){
    if($data['all_ids']){
        $allids = $data['all_ids'];
    }else{
        $allids = '';
    }
    $positionFilter = $data['position_filter'] ?? input('position_filter', 'all');
}else{
    $allids = '';
    $positionFilter = input('position_filter', 'all');
}

$positions = CareerPositions::orderBy('title')->get();
?>

<?= Form::open(['class' => 'layout']) ?>

    <div class="layout-row">
        <div style="margin-bottom: 20px;">
            <label for="position_filter_export" style="display: block; margin-bottom: 5px; font-weight: bold;">Filter by Position:</label>
            <select id="position_filter_export" name="position_filter" class="form-control" style="width: 300px; display: inline-block;">
                <option value="all" <?= $positionFilter === 'all' ? 'selected' : '' ?>>All Positions</option>
                <?php foreach ($positions as $position): ?>
                    <option value="<?= e($position->title) ?>" <?= $positionFilter === $position->title ? 'selected' : '' ?>>
                        <?= e($position->title) ?>
                    </option>
                <?php endforeach; ?>
            </select>
        </div>
        <?php echo $this->exportRender() ?>
    </div>

    <div class="form-buttons">
        <button
            type="submit"
            data-control="popup"
            data-handler="onExportLoadForm"
            data-keyboard="false"
            class="btn btn-primary">
            Export Data
        </button>
    </div>
    <input type="hidden" name="all_ids" id="all_ids" value="<?php echo $allids; ?>">
<?= Form::close() ?>
